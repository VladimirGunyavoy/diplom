# Дискретизация нелинейной системы

Рассмотрим непрерывную во времени нелинейную систему, описываемую уравнением:
\[ \dot{x}(t) = f(x(t), u(t)) \]
где \( x \in \mathbb{R}^n \) — вектор состояния, а \( u \in \mathbb{R}^m \) — вектор управления.

## 1. Линеаризация

Первым шагом является линеаризация системы в окрестности точки равновесия \( (x_e, u_e) \). Точка равновесия удовлетворяет условию \( f(x_e, u_e) = 0 \).

Введем малые отклонения от точки равновесия:
\[ \delta x(t) = x(t) - x_e \]
\[ \delta u(t) = u(t) - u_e \]

Разложим правую часть исходного уравнения в ряд Тейлора в окрестности \( (x_e, u_e) \) и ограничимся членами первого порядка малости:
\[ \dot{\delta x} = f(x_e + \delta x, u_e + \delta u) \approx f(x_e, u_e) + \frac{\partial f}{\partial x}\bigg|_{(x_e, u_e)} \delta x + \frac{\partial f}{\partial u}\bigg|_{(x_e, u_e)} \delta u \]

Поскольку \( f(x_e, u_e) = 0 \), мы получаем линеаризованную систему в непрерывном времени:
\[ \dot{\delta x}(t) = A_c \delta x(t) + B_c \delta u(t) \]
где:
- \( A_c = \frac{\partial f}{\partial x}\bigg|_{(x_e, u_e)} \) — матрица Якоби по состоянию (матрица системы).
- \( B_c = \frac{\partial f}{\partial u}\bigg|_{(x_e, u_e)} \) — матрица Якоби по управлению (матрица управления).

## 2. Дискретизация

Теперь перейдем к дискретизации линеаризованной непрерывной системы. Мы будем рассматривать систему в дискретные моменты времени \( t_k = kT \), где \( T \) — период дискретизации. Для удобства далее будем использовать обозначения \( x_k = \delta x(t_k) \) и \( u_k = \delta u(t_k) \).

Решение линейного дифференциального уравнения \( \dot{\delta x} = A_c \delta x + B_c \delta u \) на интервале \( [t_k, t_{k+1}] \) имеет вид:
\[ \delta x(t_{k+1}) = e^{A_c T} \delta x(t_k) + \int_{t_k}^{t_{k+1}} e^{A_c(t_{k+1} - \tau)} B_c \delta u(\tau) d\tau \]

Для получения дискретной модели сделаем стандартное предположение, что управляющее воздействие \( \delta u(\tau) \) является постоянным на интервале дискретизации (это называется экстраполятором нулевого порядка или Zero-Order Hold, ZOH):
\[ \delta u(\tau) = \delta u(t_k) = u_k \quad \text{для} \quad \tau \in [t_k, t_{k+1}) \]

Подставляя это предположение в интеграл, получаем:
\[ x_{k+1} = e^{A_c T} x_k + \left( \int_{t_k}^{t_{k+1}} e^{A_c(t_{k+1} - \tau)} d\tau \right) B_c u_k \]

### Откуда берется формула с интегралом?

Эта формула является точным решением линейного дифференциального уравнения \( \dot{x} = A_c x + B_c u \) на интервале \( [t_k, t_{k+1}] \). Покажем краткий вывод.

Перепишем уравнение как:
\[ \dot{x}(t) - A_c x(t) = B_c u(t) \]
Умножим обе части слева на интегрирующий множитель \( e^{-A_c t} \):
\[ e^{-A_c t}\dot{x}(t) - e^{-A_c t}A_c x(t) = e^{-A_c t}B_c u(t) \]
Заметим, что левая часть является производной произведения \( e^{-A_c t}x(t) \):
\[ \frac{d}{dt}(e^{-A_c t}x(t)) = e^{-A_c t}B_c u(t) \]
Проинтегрируем обе части от \( t_k \) до \( t \):
\[ \int_{t_k}^{t} \frac{d}{d\tau}(e^{-A_c \tau}x(\tau)) d\tau = \int_{t_k}^{t} e^{-A_c \tau}B_c u(\tau) d\tau \]
\[ e^{-A_c t}x(t) - e^{-A_c t_k}x(t_k) = \int_{t_k}^{t} e^{-A_c \tau}B_c u(\tau) d\tau \]
Умножим обе части слева на \( e^{A_c t} \):
\[ x(t) = e^{A_c (t-t_k)}x(t_k) + e^{A_c t} \int_{t_k}^{t} e^{-A_c \tau}B_c u(\tau) d\tau \]
\[ x(t) = e^{A_c (t-t_k)}x(t_k) + \int_{t_k}^{t} e^{A_c (t-\tau)}B_c u(\tau) d\tau \]
Подставив \( t = t_{k+1} \) и \( T = t_{k+1}-t_k \), мы получаем именно ту формулу, с которой начали этот раздел.

## 3. Вывод для матрицы B

Как вы и просили, уделим особое внимание выводу выражения для дискретной матрицы управления. Рассмотрим интеграл из уравнения выше. Для его вычисления сделаем замену переменной: \( s = t_{k+1} - \tau \).
При такой замене:
- Когда \( \tau = t_k \), новая переменная \( s = t_{k+1} - t_k = T \).
- Когда \( \tau = t_{k+1} \), новая переменная \( s = 0 \).
- Дифференциал \( d\tau = -ds \).

Интеграл преобразуется к виду:
\[ \int_{T}^{0} e^{A_c s} (-ds) = \int_{0}^{T} e^{A_c s} ds \]

Таким образом, мы приходим к стандартной дискретной модели в пространстве состояний:
\[ x_{k+1} = A_d x_k + B_d u_k \]
где дискретные матрицы \( A_d \) и \( B_d \) определяются как:
- \( A_d = e^{A_c T} \)
- \( B_d = \left( \int_{0}^{T} e^{A_c s} ds \right) B_c \)

### Откуда берется матричная экспонента для A_d?

Выражение для матрицы \(A_d\) описывает **собственную динамику системы**, то есть как система будет эволюционировать из состояния \(x_k\) под действием только внутренних сил, **без какого-либо управляющего воздействия** (\(u_k=0\)).

Рассмотрим однородную часть нашей линеаризованной системы (т.е. без члена с управлением):
\[ \dot{x}(t) = A_c x(t) \]

Вспомним скалярный аналог этого уравнения, который хорошо известен из базовых курсов математики:
\[ \frac{dx}{dt} = a \cdot x \]
Решением этого простого дифференциального уравнения является экспоненциальная функция:
\[ x(t) = e^{at} \cdot x(0) \]

Для систем линейных дифференциальных уравнений, записанных в матричной форме, решение имеет абсолютно аналогичную структуру. Роль скалярного числа \(a\) играет матрица \(A_c\), а роль обычной экспоненты — **матричная экспонента**.

**Матричная экспонента** \(e^{M}\) для квадратной матрицы \(M\) определяется через тот же самый ряд Тейлора, что и обычная экспонента:
\[ e^{M} = I + M + \frac{M^2}{2!} + \frac{M^3}{3!} + \dots = \sum_{k=0}^{\infty} \frac{M^k}{k!} \]
Это определение делает ее естественным обобщением экспоненты на случай матриц.

Таким образом, решение уравнения \( \dot{x}(t) = A_c x(t) \) с начальным условием \(x(t_k)\) на интервале времени \(T = t_{k+1} - t_k\) записывается как:
\[ x(t_{k+1}) = e^{A_c T} \cdot x(t_k) \]

Сравнивая это выражение с частью дискретной модели \( x_{k+1} = A_d x_k \) (при \(u_k=0\)), мы немедленно получаем:
\[ A_d = e^{A_c T} \]

Этот член показывает, в какое состояние перейдет система сама по себе за время \(T\), если на нее не подавать никакого управления.

### Способы вычисления \( B_d \)

Существует несколько подходов к вычислению интеграла для \( B_d \).

#### Способ 1: Если \( A_c \) обратима

Если матрица системы \( A_c \) невырождена (т.е. существует \( A_c^{-1} \)), то интеграл от матричной экспоненты можно вычислить аналитически:
\[ \int e^{A_c s} ds = A_c^{-1} e^{A_c s} \]
Тогда определенный интеграл равен:
\[ \int_{0}^{T} e^{A_c s} ds = A_c^{-1} [e^{A_c s}]_{0}^{T} = A_c^{-1} (e^{A_c T} - e^{A_c \cdot 0}) = A_c^{-1} (A_d - I) \]
где \( I \) — единичная матрица.

В этом случае матрица \( B_d \) вычисляется по формуле:
\[ B_d = A_c^{-1} (A_d - I) B_c \]

#### Способ 2: Через разложение в ряд (общий случай)

Этот метод является универсальным и работает для любых матриц \( A_c \), включая вырожденные. Разложим матричную экспоненту в ряд Тейлора:
\[ e^{A_c s} = \sum_{k=0}^{\infty} \frac{(A_c s)^k}{k!} = I + A_c s + \frac{A_c^2 s^2}{2!} + \frac{A_c^3 s^3}{3!} + \dots \]

Проинтегрируем этот ряд почленно по \( s \) от 0 до \( T \):
\[ \int_{0}^{T} e^{A_c s} ds = \int_{0}^{T} \left( \sum_{k=0}^{\infty} \frac{A_c^k s^k}{k!} \right) ds = \sum_{k=0}^{\infty} \frac{A_c^k}{k!} \int_{0}^{T} s^k ds \]
\[ = \sum_{k=0}^{\infty} \frac{A_c^k}{k!} \frac{T^{k+1}}{k+1} = \sum_{k=0}^{\infty} \frac{A_c^k T^{k+1}}{(k+1)!} \]

Распишем первые несколько членов ряда:
\[ \int_{0}^{T} e^{A_c s} ds = I \cdot T + A_c \frac{T^2}{2!} + A_c^2 \frac{T^3}{3!} + A_c^3 \frac{T^4}{4!} + \dots \]

Следовательно, матрица \( B_d \) вычисляется как:
\[ B_d = \left( T \cdot I + \frac{T^2}{2!} A_c + \frac{T^3}{3!} A_c^2 + \dots \right) B_c \]

На практике для численного нахождения матриц \( A_d \) и \( B_d \) часто используют более устойчивые методы, например, метод Ван Лоана, который основан на вычислении экспоненты от блочной матрицы и не требует проверки \( A_c \) на обратимость.
