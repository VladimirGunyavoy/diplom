# Теория дискретизации системы маятника

## 1. Нелинейная модель маятника

Уравнение движения маятника с управлением:

$$\ddot{\theta} = -\frac{g}{l}\sin(\theta) + u$$

где:
- $\theta$ — угол отклонения от вертикали
- $g$ — ускорение свободного падения
- $l$ — длина маятника  
- $u$ — управляющий момент

## 2. Представление в пространстве состояний

Введем вектор состояния $x = [\theta, \dot{\theta}]^T$:

$$\dot{x} = \begin{bmatrix} \dot{\theta} \\ \ddot{\theta} \end{bmatrix} = \begin{bmatrix} \dot{\theta} \\ -\frac{g}{l}\sin(\theta) + u \end{bmatrix} = f(x, u)$$

## 3. Линеаризация системы

### 3.1 Точка линеаризации

Линеаризуем вокруг нижнего положения равновесия: $x_0 = [0, 0]^T$, $u_0 = 0$.

### 3.2 Вычисление якобианов

$$A = \frac{\partial f}{\partial x}\bigg|_{x_0, u_0} = \begin{bmatrix} 
\frac{\partial \dot{\theta}}{\partial \theta} & \frac{\partial \dot{\theta}}{\partial \dot{\theta}} \\
\frac{\partial \ddot{\theta}}{\partial \theta} & \frac{\partial \ddot{\theta}}{\partial \dot{\theta}}
\end{bmatrix}\bigg|_{0,0}$$

$$A = \begin{bmatrix} 
0 & 1 \\
-\frac{g}{l}\cos(0) & 0
\end{bmatrix} = \begin{bmatrix} 
0 & 1 \\
-\frac{g}{l} & 0
\end{bmatrix}$$

$$B = \frac{\partial f}{\partial u}\bigg|_{x_0, u_0} = \begin{bmatrix} 
\frac{\partial \dot{\theta}}{\partial u} \\
\frac{\partial \ddot{\theta}}{\partial u}
\end{bmatrix} = \begin{bmatrix} 
0 \\
1
\end{bmatrix}$$

### 3.3 Линеаризованная система

$$\dot{x} = Ax + Bu$$

где $A = \begin{bmatrix} 0 & 1 \\ -\frac{g}{l} & 0 \end{bmatrix}$, $B = \begin{bmatrix} 0 \\ 1 \end{bmatrix}$

## 4. Точная дискретизация

### 4.1 Решение линейной системы

Решение однородного уравнения $\dot{x} = Ax$:
$$x(t) = e^{At}x(0)$$

Решение неоднородного уравнения $\dot{x} = Ax + Bu$ при постоянном $u$:
$$x(t) = e^{At}x(0) + \int_0^t e^{A(t-\tau)}B \, d\tau \cdot u$$

### 4.2 Вычисление интеграла

$$\int_0^t e^{A(t-\tau)}B \, d\tau = e^{At}\int_0^t e^{-A\tau} \, d\tau \cdot B$$

При $t = \Delta t$:
$$\int_0^{\Delta t} e^{A(\Delta t-\tau)}B \, d\tau = A^{-1}(e^{A\Delta t} - I)B$$

### 4.3 Дискретная система

$$x_{k+1} = A_d x_k + B_d u_k$$

где:
- $A_d = e^{A\Delta t}$ — матрица перехода состояния
- $B_d = A^{-1}(e^{A\Delta t} - I)B$ — матрица управления

## 5. Метод расширенной матрицы

### 5.1 Проблема обратимости

Если матрица $A$ не обратима, используем **метод расширенной матрицы**:

$$\Phi = \exp\begin{bmatrix} A\Delta t & B\Delta t \\ 0 & 0 \end{bmatrix}$$

### 5.2 Структура результата

$$\Phi = \begin{bmatrix} 
e^{A\Delta t} & A^{-1}(e^{A\Delta t} - I)B \\
0 & I
\end{bmatrix}$$

Откуда:
- $A_d = \Phi[1:n, 1:n]$
- $B_d = \Phi[1:n, n+1:n+m]$

### 5.3 Численная реализация

```python
n, m = A.shape[0], B.shape[1]
Phi_matrix = np.zeros((n + m, n + m))
Phi_matrix[0:n, 0:n] = A * dt
Phi_matrix[0:n, n:n+m] = B * dt

Phi = expm(Phi_matrix)
A_discrete = Phi[0:n, 0:n]
B_discrete = Phi[0:n, n:n+m]
```

## 6. Свойства дискретной системы

### 6.1 Собственные значения

Если $\lambda$ — собственное значение $A$, то $e^{\lambda \Delta t}$ — собственное значение $A_d$.

### 6.2 Устойчивость

**Непрерывная система:**
- Устойчива, если $\text{Re}(\lambda_i) < 0$ $\forall i$
- Нейтрально устойчива, если $\text{Re}(\lambda_i) \leq 0$ и простые корни на мнимой оси

**Дискретная система:**
- Устойчива, если $|\lambda_{d,i}| < 1$ $\forall i$
- Нейтрально устойчива, если $|\lambda_{d,i}| \leq 1$ и простые корни на единичной окружности

### 6.3 Для маятника

Собственные значения непрерывной системы:
$$\lambda_{1,2} = \pm i\sqrt{\frac{g}{l}}$$

Собственные значения дискретной системы:
$$\lambda_{d,1,2} = e^{\pm i\sqrt{\frac{g}{l}}\Delta t} = \cos\left(\sqrt{\frac{g}{l}}\Delta t\right) \pm i\sin\left(\sqrt{\frac{g}{l}}\Delta t\right)$$

Модуль: $|\lambda_{d,1,2}| = 1$ → система остается нейтрально устойчивой.

## 7. Численные характеристики

### 7.1 Характерная частота

$$\omega_0 = \sqrt{\frac{g}{l}}$$

### 7.2 Период колебаний

$$T = \frac{2\pi}{\omega_0} = 2\pi\sqrt{\frac{l}{g}}$$

### 7.3 Критерий точности

Для сохранения точности необходимо:
$$\Delta t < \frac{\pi}{10\omega_0}$$

## 8. Проверка корректности

### 8.1 Сохранение энергии

Для консервативной системы ($u = 0$) энергия должна сохраняться:
$$E = \frac{1}{2}m l^2 \dot{\theta}^2 + mgl(1 - \cos\theta)$$

### 8.2 Проверка собственных значений

$$\lambda_d = e^{\lambda \Delta t}$$

### 8.3 Сравнение с аналитическим решением

При малых углах аналитическое решение:
$$\theta(t) = \theta_0 \cos(\omega_0 t) + \frac{\dot{\theta}_0}{\omega_0}\sin(\omega_0 t)$$

## 9. Применения

### 9.1 Синтез управления

Дискретные матрицы используются для:
- **LQR управления** (Linear Quadratic Regulator)
- **MPC** (Model Predictive Control)  
- **Построения графов достижимости**

### 9.2 Анализ управляемости

Матрица управляемости для дискретной системы:
$$\mathcal{C}_d = [B_d, A_d B_d, A_d^2 B_d, \ldots, A_d^{n-1} B_d]$$

Система управляема, если $\text{rank}(\mathcal{C}_d) = n$.

### 9.3 Планирование траекторий

Дискретная модель позволяет эффективно планировать траектории в пространстве состояний методами:
- Динамического программирования
- Алгоритмов на графах
- Оптимизации

## 10. Заключение

Точная дискретизация через матричную экспоненту обеспечивает:

1. **Математическую строгость** — точное решение линейной системы
2. **Численную стабильность** — сохранение спектральных свойств
3. **Физическую корректность** — сохранение консервативных законов
4. **Практическую применимость** — готовность для методов дискретного управления

Этот подход является золотым стандартом для дискретизации линейных систем управления.