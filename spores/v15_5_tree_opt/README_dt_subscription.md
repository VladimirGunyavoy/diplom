# –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø: –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è dt –≤ InputManager

## –û–±–∑–æ—Ä
–£—Å–ø–µ—à–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è dt –≤ InputManager, –∫–æ—Ç–æ—Ä–∞—è –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Ä–µ–∞–∫—Ü–∏—é –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ —Å–∏—Å—Ç–µ–º—ã –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —à–∞–≥–∞.

## –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### –®–ê–ì 1: –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è dt –≤ InputManager

#### 1.1 –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–ø–∏—Å–∫–∞ –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä InputManager
**–§–∞–π–ª**: `src/managers/input_manager.py`
```python
# –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è dt (—á—Ç–æ–±—ã –ø—Ä–∏–∑—Ä–∞–∫–∏ –∏ –ª–∏–Ω–∫–∏ –≤—Å–µ–≥–¥–∞ —Ä–µ–∞–≥–∏—Ä–æ–≤–∞–ª–∏)
if self.dt_manager and hasattr(self.dt_manager, "subscribe_on_change"):
    self.dt_manager.subscribe_on_change(self._on_dt_changed)
```

#### 1.2 –î–æ–±–∞–≤–ª–µ–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ _on_dt_changed
**–§–∞–π–ª**: `src/managers/input_manager.py`
```python
def _on_dt_changed(self):
    """
    –ì–ª–æ–±–∞–ª—å–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ dt:
    - –ø–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ–º –ø—Ä–∏–∑—Ä–∞—á–Ω–æ–µ –¥–µ—Ä–µ–≤–æ (–µ—Å–ª–∏ –µ—Å—Ç—å),
    - –ø—Ä–∏–º–µ–Ω—è–µ–º –ª–∏–º–∏—Ç –¥–ª–∏–Ω—ã –∫–æ –≤—Å–µ–º –ª–∏–Ω–∫–∞–º: –æ–±—ã—á–Ω—ã–º –∏ –ø—Ä–∏–∑—Ä–∞—á–Ω—ã–º.
    """
    try:
        # 1) –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –ø—Ä–∏–∑—Ä–∞—á–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è (–¥–µ—Ç–∏/–≤–Ω—É–∫–∏ –¥–≤–∏–≥–∞—é—Ç—Å—è)
        if self.manual_spore_manager and hasattr(self.manual_spore_manager, "_update_predictions"):
            self.manual_spore_manager._update_predictions()

        # 2) –ü—Ä–∏–º–µ–Ω–∏—Ç—å –Ω–æ–≤—ã–π –ª–∏–º–∏—Ç –¥–ª–∏–Ω—ã –¥–ª—è –í–°–ï–• –ª–∏–Ω–∫–æ–≤
        max_len = None
        if self.dt_manager and hasattr(self.dt_manager, "get_max_link_length"):
            max_len = self.dt_manager.get_max_link_length()

        # 2a) –û–±—ã—á–Ω—ã–µ –ª–∏–Ω–∫–∏ (—á–µ—Ä–µ–∑ SporeManager)
        if self.spore_manager and hasattr(self.spore_manager, "update_links_max_length"):
            self.spore_manager.update_links_max_length(max_len)

        # 2b) –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–µ –ª–∏–Ω–∫–∏ (—á–µ—Ä–µ–∑ PredictionManager)
        if self.manual_spore_manager and hasattr(self.manual_spore_manager, "prediction_manager"):
            pm = self.manual_spore_manager.prediction_manager
            if hasattr(pm, "update_links_max_length"):
                pm.update_links_max_length(max_len)
            # –ù–∞ –≤—Å—è–∫–∏–π —Å–ª—É—á–∞–π –æ–±–Ω–æ–≤–∏–º –≥–µ–æ–º–µ—Ç—Ä–∏—é
            if hasattr(pm, "prediction_links"):
                for link in pm.prediction_links:
                    try:
                        link.update_geometry()
                    except Exception:
                        pass
    except Exception as e:
        print(f"[InputManager] _on_dt_changed error: {e}")
```

### –®–ê–ì 2: –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ update_links_max_length –≤ PredictionManager

**–§–∞–π–ª**: `src/managers/manual_creation/prediction_manager.py`
```python
def update_links_max_length(self, max_length: Optional[float]) -> None:
    """–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –¥–ª–∏–Ω—É –≤—Å–µ—Ö –ø—Ä–∏–∑—Ä–∞—á–Ω—ã—Ö –ª–∏–Ω–∫–æ–≤ –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –≥–µ–æ–º–µ—Ç—Ä–∏—é."""
    for link in getattr(self, 'prediction_links', []):
        try:
            link.set_max_length(max_length)
        except Exception as e:
            print(f"[PredictionManager] –ù–µ —É–¥–∞–ª–æ—Å—å –æ–±–Ω–æ–≤–∏—Ç—å max_length –ª–∏–Ω–∫–∞: {e}")
```

### –®–ê–ì 3: –î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –≤ DTManager

#### 3.1 –î–æ–±–∞–≤–ª–µ–Ω —Å–ø–∏—Å–æ–∫ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
**–§–∞–π–ª**: `src/managers/dt_manager.py`
```python
# –°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è dt
self._subscribers = []
```

#### 3.2 –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç–æ–¥—ã –ø–æ–¥–ø–∏—Å–∫–∏
```python
def subscribe_on_change(self, callback) -> None:
    """–ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–ª–±—ç–∫ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è dt."""
    if callback not in self._subscribers:
        self._subscribers.append(callback)
        print(f"   üìß –ü–æ–¥–ø–∏—Å—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ DTManager (–≤—Å–µ–≥–æ: {len(self._subscribers)})")

def unsubscribe_on_change(self, callback) -> None:
    """–û—Ç–ø–∏—Å—ã–≤–∞–µ—Ç –∫–æ–ª–±—ç–∫ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π dt."""
    if callback in self._subscribers:
        self._subscribers.remove(callback)
        print(f"   üìß –ü–æ–¥–ø–∏—Å—á–∏–∫ —É–¥–∞–ª–µ–Ω –∏–∑ DTManager (–æ—Å—Ç–∞–ª–æ—Å—å: {len(self._subscribers)})")

def _notify_subscribers(self) -> None:
    """–£–≤–µ–¥–æ–º–ª—è–µ—Ç –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ dt."""
    for subscriber in self._subscribers:
        try:
            subscriber()
        except Exception as e:
            print(f"[DTManager] –û—à–∏–±–∫–∞ –≤ –ø–æ–¥–ø–∏—Å—á–∏–∫–µ: {e}")
```

#### 3.3 –û–±–Ω–æ–≤–ª–µ–Ω –º–µ—Ç–æ–¥ _notify_dt_changed
```python
def _notify_dt_changed(self) -> None:
    """–ö–æ–ª–±—ç–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ dt ‚Äî –æ–±–Ω–æ–≤–ª—è–µ–º –¥–ª–∏–Ω—ã –≤—Å–µ—Ö –ª–∏–Ω–∫–æ–≤ –∏ —É–≤–µ–¥–æ–º–ª—è–µ–º –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤."""
    try:
        if getattr(self, 'spore_manager', None):
            self.spore_manager.update_links_max_length(self.get_max_link_length())
    except Exception as e:
        print(f"[DTManager] –û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –¥–ª–∏–Ω –ª–∏–Ω–∫–æ–≤: {e}")
    
    # –£–≤–µ–¥–æ–º–ª—è–µ–º –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤
    self._notify_subscribers()
```

### –®–ê–ì 4: –î–æ–±–∞–≤–ª–µ–Ω –≤—ã–∑–æ–≤ _on_dt_changed –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è P

**–§–∞–π–ª**: `src/managers/input_manager.py`
```python
print(f"‚úÖ –ü—Ä–∏–∑—Ä–∞—á–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ —Å–æ —Å–ø–∞—Ä–µ–Ω–Ω—ã–º–∏ dt!")

# –°—Ä–∞–∑—É –ø—Ä–∏–≤–µ—Å—Ç–∏ –≤—Å—ë –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ —Ç–µ–∫—É—â–µ–º—É dt –∏ –ª–∏–º–∏—Ç–∞–º –¥–ª–∏–Ω—ã
if self.dt_manager and hasattr(self, "_on_dt_changed"):
    self._on_dt_changed()
```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–¥–ø–∏—Å–∫–∏:
```
DTManager._notify_dt_changed()
    ‚Üì
DTManager._notify_subscribers()
    ‚Üì
InputManager._on_dt_changed()
    ‚Üì
‚îú‚îÄ‚îÄ manual_spore_manager._update_predictions()  # –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞ –ø—Ä–∏–∑—Ä–∞–∫–æ–≤
‚îú‚îÄ‚îÄ spore_manager.update_links_max_length()     # –û–±—ã—á–Ω—ã–µ –ª–∏–Ω–∫–∏
‚îî‚îÄ‚îÄ prediction_manager.update_links_max_length() # –ü—Ä–∏–∑—Ä–∞—á–Ω—ã–µ –ª–∏–Ω–∫–∏
```

### –ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Å–æ–±—ã—Ç–∏–π:
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–∑–º–µ–Ω—è–µ—Ç dt** (Ctrl + –∫–æ–ª–µ—Å–æ –º—ã—à–∏)
2. **DTManager** –≤—ã–∑—ã–≤–∞–µ—Ç `_notify_dt_changed()`
3. **DTManager** —É–≤–µ–¥–æ–º–ª—è–µ—Ç –≤—Å–µ—Ö –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤ —á–µ—Ä–µ–∑ `_notify_subscribers()`
4. **InputManager._on_dt_changed()** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
   - –ü–µ—Ä–µ—Å–æ–±–∏—Ä–∞–µ—Ç –ø—Ä–∏–∑—Ä–∞—á–Ω—ã–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç –Ω–æ–≤—ã–π –ª–∏–º–∏—Ç –¥–ª–∏–Ω—ã –∫–æ –≤—Å–µ–º –ª–∏–Ω–∫–∞–º
   - –û–±–Ω–æ–≤–ª—è–µ—Ç –≥–µ–æ–º–µ—Ç—Ä–∏—é –ø—Ä–∏–∑—Ä–∞—á–Ω—ã—Ö –ª–∏–Ω–∫–æ–≤

### –ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è P:
1. **–°–æ–∑–¥–∞–µ—Ç—Å—è –ø—Ä–∏–∑—Ä–∞—á–Ω–æ–µ –¥–µ—Ä–µ–≤–æ** —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–∏
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è** `_on_dt_changed()`
3. **–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É—é—Ç—Å—è** —Å —Ç–µ–∫—É—â–∏–º dt

## –†–µ–∑—É–ª—å—Ç–∞—Ç

‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–∫—Ü–∏—è** –≤—Å–µ—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ dt
‚úÖ **–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø—Ä–∏–∑—Ä–∞—á–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤** —Å —Ç–µ–∫—É—â–∏–º dt
‚úÖ **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª–∏–Ω—ã –≤—Å–µ—Ö –ª–∏–Ω–∫–æ–≤** (–æ–±—ã—á–Ω—ã—Ö –∏ –ø—Ä–∏–∑—Ä–∞—á–Ω—ã—Ö)
‚úÖ **–ú–≥–Ω–æ–≤–µ–Ω–Ω–∞—è —Ä–µ–∞–∫—Ü–∏—è** –ø–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è P
‚úÖ **–ù–∞–¥–µ–∂–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–æ–∫** —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test_dt_subscription.py`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- ‚úÖ –ò–º–ø–æ—Ä—Ç—ã –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –º–æ–¥—É–ª–µ–π
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ DTManager –∏ InputManager
- ‚úÖ –ù–∞–ª–∏—á–∏–µ –º–µ—Ç–æ–¥–æ–≤ –ø–æ–¥–ø–∏—Å–∫–∏
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –ø–æ–¥–ø–∏—Å–∫—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ InputManager
- ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏–µ dt –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –ø–æ–¥–ø–∏—Å—á–∏–∫–æ–≤

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ dt –≤ –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏—è:
```
üìß –ü–æ–¥–ø–∏—Å—á–∏–∫ –¥–æ–±–∞–≤–ª–µ–Ω –≤ DTManager (–≤—Å–µ–≥–æ: 1)
üîΩ dt —É–º–µ–Ω—å—à–µ–Ω: 0.0500 ‚Üí 0.0455 (√∑1.1)
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ InputManager** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è dt
2. **–ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ dt** –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è
3. **–ü–æ—Å–ª–µ –Ω–∞–∂–∞—Ç–∏—è P** –≤—Å–µ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è —Å —Ç–µ–∫—É—â–∏–º dt

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–°–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è dt –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞. –¢–µ–ø–µ—Ä—å –≤—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —Å–∏—Å—Ç–µ–º—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–µ–∞–≥–∏—Ä—É—é—Ç –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —à–∞–≥–∞, –æ–±–µ—Å–ø–µ—á–∏–≤–∞—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Ä–∞–±–æ—Ç—É –≤—Å–µ—Ö –ª–∏–Ω–∫–æ–≤.
