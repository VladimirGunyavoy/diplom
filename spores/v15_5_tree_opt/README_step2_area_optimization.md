# –®–ê–ì 2: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ –ø–ª–æ—â–∞–¥–∏ –≤ –ø–∞–π–ø–ª–∞–π–Ω —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –∏–∑ –ø–∞—Ä

## –û–ø–∏—Å–∞–Ω–∏–µ
–£—Å–ø–µ—à–Ω–æ –∏–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–æ –ø–ª–æ—â–∞–¥–∏ –≤ –ø–∞–π–ø–ª–∞–π–Ω —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –∏–∑ –ø–∞—Ä. –¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–≥–æ —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –∏–∑ –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –ø–∞—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–ª–æ—â–∞–¥–∏ —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç–æ–≤ –ø–∞—Ä.

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### 1. src/logic/tree/pairs/create_tree_from_pairs.py
- **–î–æ–±–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç**: `from ..area_opt.optimize_tree_area import optimize_tree_area`
- **–î–æ–±–∞–≤–ª–µ–Ω –±–ª–æ–∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ –ø–ª–æ—â–∞–¥–∏** –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è optimized_tree
- **–î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** area_optimization –∏–∑ config
- **–î–æ–±–∞–≤–ª–µ–Ω area_summary** –≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
- **–î–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ 'area_optimization'** –≤ —Ñ–∏–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

### 2. config/json/config.json
- **–î–æ–±–∞–≤–ª–µ–Ω–∞ —Å–µ–∫—Ü–∏—è area_optimization** –≤ –±–ª–æ–∫ tree:
  ```json
  "area_optimization": {
    "enabled": true,
    "constraint_distance": 1e-4,
    "dt_bounds": [0.001, 0.2],
    "max_iterations": 1500,
    "method": "SLSQP"
  }
  ```

## –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –∏–∑ –ø–∞—Ä** —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `config['tree']['area_optimization']['enabled']`
2. **–ï—Å–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –≤–∫–ª—é—á–µ–Ω–∞**, –∏–∑–≤–ª–µ–∫–∞—é—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:
   - `constraint_distance` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –¥–æ–ø—É—Å—Ç–∏–º–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –ø–∞—Ä–∞—Ö
   - `dt_bounds` - –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è –≤—Å–µ—Ö dt
   - `max_iterations` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π
   - `method` - –º–µ—Ç–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (SLSQP, L-BFGS-B, etc.)
3. **–í—ã–∑—ã–≤–∞–µ—Ç—Å—è optimize_tree_area()** —Å —Ç–µ–∫—É—â–∏–º –¥–µ—Ä–µ–≤–æ–º, –ø–∞—Ä–∞–º–∏ –∏ –º–∞—è—Ç–Ω–∏–∫–æ–º
4. **–ï—Å–ª–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞**, –¥–µ—Ä–µ–≤–æ –ø–æ–¥–º–µ–Ω—è–µ—Ç—Å—è –Ω–∞ area-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ
5. **–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è** –≤ area_summary –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞

## –†–µ–∑—É–ª—å—Ç–∞—Ç

- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–ª–æ—â–∞–¥–∏** –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –¥–µ—Ä–µ–≤–∞ –∏–∑ –ø–∞—Ä
- **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç–æ–≤ –ø–∞—Ä** - —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è –º–µ–∂–¥—É –ø–∞—Ä–∞–º–∏ –Ω–µ –ø—Ä–µ–≤—ã—à–∞—é—Ç constraint_distance
- **–£–ª—É—á—à–µ–Ω–∏–µ –ø–ª–æ—â–∞–¥–∏ –¥–µ—Ä–µ–≤–∞** –ø—Ä–∏ —Å–æ–±–ª—é–¥–µ–Ω–∏–∏ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–π
- **–ü–æ–¥—Ä–æ–±–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞** –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –≤ –ª–æ–≥–∞—Ö –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç `test_area_optimization_imports.py`, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–æ–≤–µ—Ä—è–µ—Ç:
- ‚úÖ –ò–º–ø–æ—Ä—Ç—ã –≤—Å–µ—Ö –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –º–æ–¥—É–ª–µ–π
- ‚úÖ –ó–∞–≥—Ä—É–∑–∫—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ SporeTreeConfig
- ‚úÖ –°–∏–≥–Ω–∞—Ç—É—Ä—É —Ñ—É–Ω–∫—Ü–∏–∏ optimize_tree_area
- ‚úÖ –ù–∞–ª–∏—á–∏–µ –≤—Å–µ—Ö –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–æ –ø–ª–æ—â–∞–¥–∏ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≤ `config['tree']['area_optimization']`:
- `enabled: true/false` - –≤–∫–ª—é—á–∏—Ç—å/–≤—ã–∫–ª—é—á–∏—Ç—å –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—é
- `constraint_distance: 1e-4` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –≤ –ø–∞—Ä–∞—Ö
- `dt_bounds: [0.001, 0.2]` - –≥—Ä–∞–Ω–∏—Ü—ã –¥–ª—è dt
- `max_iterations: 1500` - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏—Ç–µ—Ä–∞—Ü–∏–π
- `method: "SLSQP"` - –º–µ—Ç–æ–¥ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏

## –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏ `show=True` –≤ –ª–æ–≥–∞—Ö –ø–æ—è–≤–ª—è—é—Ç—Å—è –±–ª–æ–∫–∏:
```
üî∑ –ó–∞–ø—É—Å–∫ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø–ª–æ—â–∞–¥–∏ –¥–µ—Ä–µ–≤–∞ —Å –∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç–∞–º–∏:
   constraint_distance=0.0001, dt_bounds=(0.001, 0.2), max_iterations=1500, method=SLSQP
‚úÖ –ü–ª–æ—â–∞–¥—å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–∞, –ø–æ–¥–º–µ–Ω—è–µ–º –¥–µ—Ä–µ–≤–æ –Ω–∞ area-–æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ
```

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–¢–µ–ø–µ—Ä—å –ø–∞–π–ø–ª–∞–π–Ω –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤:
1. ‚úÖ –ü–æ–∏—Å–∫ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –ø–∞—Ä –≤–Ω—É–∫–æ–≤
2. ‚úÖ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã—Ö –≤—Ä–µ–º–µ–Ω –∏–∑ –ø–∞—Ä
3. ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –¥–µ—Ä–µ–≤–∞ –∏–∑ –ø–∞—Ä
4. ‚úÖ **–ù–û–í–û–ï: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–ª–æ—â–∞–¥–∏ —Å –∫–æ–Ω—Å—Ç—Ä–µ–π–Ω—Ç–∞–º–∏ –ø–∞—Ä**
