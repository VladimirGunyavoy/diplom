# Промпт для следующего агента: Отладка InputManager

Привет! Я работаю над рефакторингом системы ввода в проекте `diplom/spores/10`. Моя цель - централизовать всю обработку пользовательского ввода в одном классе `InputManager`, а все покадровые обновления - в `UpdateManager`. За основу взята рабочая логика из `diplom/spores/9_stable`.

## Текущее состояние:

1.  **Созданы менеджеры**:
    *   `diplom/spores/10/src/managers/input_manager.py`
    *   `diplom/spores/10/src/managers/update_manager.py`
2.  **Главный скрипт обновлен**: `diplom/spores/10/scripts/run/1.py` использует эти два менеджера.
3.  **Логика движения**: Управление камерой (`WASD`, мышь) осуществляется через стандартный `FirstPersonController` из Ursina. Его состоянием (`enabled`) управляет `diplom/spores/10/src/visual/scene_setup.py`.

## Проблема:

**Несмотря на все усилия, работают только клавиши движения (`WASD`, `Shift/Space`) и выход (`q`). Все остальные команды (`f`, `e`, `t`, `r`, `1`, `2`, `3`, `4`, `z`, `x`, `h`) не срабатывают.**

-   При запуске работает управление камерой.
-   При нажатии на `Alt` курсор мыши корректно освобождается, а `scene_setup.toggle_cursor()` устанавливает `player.enabled = False`. Это подтверждено отладочным выводом.
-   Однако, после освобождения курсора, `InputManager` все равно не обрабатывает остальные клавиши.

## Что было проверено:

-   С помощью `print` мы убедились, что глобальная функция `input(key)` в `run/1.py` **вызывается** для всех клавиш.
-   Это означает, что `FirstPersonController` не блокирует вызов глобального обработчика полностью.

## Гипотеза и следующие шаги:

Проблема, скорее всего, кроется в том, как `InputManager` проверяет состояние блокировки, или в каком-то тонком взаимодействии с `FirstPersonController`, который, даже будучи в состоянии `enabled=False`, как-то влияет на обработку событий.

**Рекомендуемый план действий для следующего агента:**

1.  **Повторно добавить отладку в `InputManager`**: Добавь `print` в начало метода `InputManager.handle_input()`, чтобы увидеть значение `key` и `self.scene_setup.cursor_locked` в момент вызова.
2.  **Проверить условие блокировки**: Внимательно изучи условие `if self.scene_setup and self.scene_setup.cursor_locked: return`. Возможно, оно отрабатывает некорректно. Выведи в консоль результат этого условия.
3.  **Изолировать проблему**: Попробуй закомментировать это условие и посмотреть, начнут ли команды обрабатываться (пусть даже и в неправильное время). Это поможет понять, в нем ли дело.

Нужно сфокусироваться на `InputManager.handle_input()` и понять, почему он прерывает выполнение для всех клавиш, кроме `q` и `alt`, даже когда `cursor_locked` имеет значение `False`. Удачи!
